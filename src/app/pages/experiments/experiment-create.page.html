<ion-header>
  <ion-toolbar>
    <ion-title>Create Experiment</ion-title>
  </ion-toolbar>
</ion-header>
<div style="display: flex; flex-direction: row; height: 100vh; box-sizing: border-box;">
  <!-- Scrollable sidebar form -->
  <div style="flex: 0 0 500px; max-width: 500px; height: 100vh; overflow-y: auto; border-right: 1px solid #eee; padding: 24px; box-sizing: border-box; background: #fff; position: relative;">
    <form #expForm="ngForm" (ngSubmit)="onSubmit(expForm)">
      <ion-list>
        <ion-item [class.invalid-field]="expForm.submitted && (!experiment.Name || experiment.Name.length > 50)">
          <ion-label position="stacked">Name <span class="required">*</span></ion-label>
          <ion-input [(ngModel)]="experiment.Name" name="Name" required maxlength="50"></ion-input>
        </ion-item>
        <ion-item [class.invalid-field]="experiment.Description && experiment.Description.length > 1000">
          <ion-label position="stacked">Description</ion-label>
          <ion-textarea [(ngModel)]="experiment.Description" name="Description" maxlength="1000"></ion-textarea>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Model File (Optional)</ion-label>
          <input type="file" (change)="onModelFileChange($event)" accept=".py,.ipynb,.pkl,.h5,.pt,.pth,.onnx" />
        </ion-item>
        <div style="color: var(--ion-color-medium); font-size: 13px; margin-left: 16px; margin-bottom: 8px;">
          Upload a model file (.py, .ipynb, .pkl, .h5, .pt, .pth, .onnx) up to 100MB. This can also be done during experiment execution.
        </div>
        <div style="color: var(--ion-color-danger); margin-left: 16px; margin-bottom: 8px;" *ngIf="modelFileError">{{ modelFileError }}</div>
        <ion-item>
          <ion-label position="stacked">Status</ion-label>
          <ion-select [(ngModel)]="experiment.Status" name="Status" interface="popover">
            <ion-select-option value="Draft">Draft</ion-select-option>
            <ion-select-option value="Active">Active</ion-select-option>
            <ion-select-option value="Completed">Completed</ion-select-option>
            <ion-select-option value="Archived">Archived</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-list>
      <div style="color: var(--ion-color-danger); margin-left: 16px; margin-bottom: 8px;" *ngIf="expForm.submitted && missingFields.length">
        Please complete the following required fields: {{ missingFields.join(', ') }}
      </div>
      <hr style="margin: 32px 0 16px 0; border: none; border-top: 1px solid #eee;" />
      <div style="display: flex; gap: 8px; justify-content: center; margin-bottom: 32px;">
        <ion-button expand="block" type="submit" [disabled]="formInvalid()">
          <ion-spinner *ngIf="submitting" name="dots"></ion-spinner>
          <span *ngIf="!submitting">Create</span>
        </ion-button>
        <ion-button expand="block" fill="clear" type="button" (click)="router.navigate(['/experiments'])" [disabled]="submitting">Cancel</ion-button>
      </div>
    </form>
    <div *ngIf="showToast" style="position: fixed; bottom: 24px; left: 0; right: 0; z-index: 1000; text-align: center;">
      <div style="display: inline-block; background: var(--ion-color-danger); color: white; padding: 12px 24px; border-radius: 8px;">
        {{ toastMessage }}
      </div>
    </div>
  </div>
  <!-- Right column for future use or empty -->
  <div style="flex: 1 1 auto; background: #f6f6f6;"></div>
</div>
<style>
  .invalid-field {
    --border-color: var(--ion-color-danger);
    border-color: var(--ion-color-danger) !important;
  }
  .required {
    color: var(--ion-color-danger);
  }
</style> 